#!/bin/bash

# Bash wrappers for docker run commands
export DOCKER_REPO_PREFIX=jess

ctr_rm() {
	# shellcheck disable=SC2068
	docker rm -f $@ 2>/dev/null || true
}

ctr_del() {
	local name=$1
	local state
	state=$(docker inspect --format "{{.State.Running}}" "$name" 2>/dev/null)

	if [[ "$state" == "false" ]]; then
		docker rm "$name"
	fi
}

ctr_link() {
	for container in "$@"; do
		local state
		state=$(docker inspect --format "{{.State.Running}}" "$container" 2>/dev/null)

		if [[ "$state" == "false" ]] || [[ "$state" == "" ]]; then
			echo "$container is not running, starting it for you."
			$container
		fi
	done
}

############################################
#############    CLI TOOLS    ##############
############################################
aws() {
	docker run -it --rm \
		-v "${HOME}/.aws:/root/.aws" \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/awscli "$@"
}

az() {
	docker run -it --rm \
		-v "${HOME}/.azure:/root/.azure" \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/azure-cli "$@"
}

gcloud() {
	docker run -it --rm \
		-v "${HOME}/.gcloud:/root/.config/gcloud" \
		-v "${HOME}/.ssh:/root/.ssh:ro" \
		-v "$(command -v docker):/usr/bin/docker" \
		-v /var/run/docker.sock:/var/run/docker.sock \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/gcloud "$@"
}

htop() {
	docker run -it --rm \
		--pid host \
		--net none \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/htop
}
htpasswd() {
	docker run -it --rm \
		--net none \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/htpasswd "$@"
}

http() {
	docker run -t --rm \
		-v /var/run/docker.sock:/var/run/docker.sock \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/httpie "$@"
}

mc() {
	cwd="$(pwd)"
	name="$(basename "$cwd")"

	docker run -it --rm \
		-v "${cwd}:/home/mc/${name}" \
		--workdir "/home/mc/${name}" \
		--log-driver none \
		${DOCKER_REPO_PREFIX}/mc "$@"
}

terraform() {
	docker run -it --rm \
		-v "${HOME}:${HOME}:ro" \
		-v "$(pwd):/usr/src/repo" \
		-v /tmp:/tmp \
		-e GOOGLE_APPLICATION_CREDENTIALS \
		-e SSH_AUTH_SOCK \
		--workdir /usr/src/repo \
 		--log-driver none \
		${DOCKER_REPO_PREFIX}/terraform "$@"
}